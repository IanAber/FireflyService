<html lang="en">
<head>
  <title id='Description'>Analog Data</title>
  <link rel="stylesheet" href="/scripts/jqwidgets/styles/jqx.base.css" type="text/css" />
  <link rel="stylesheet" href="/scripts/jqwidgets/styles/jqx.web.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="/css/fireflyio.css">
  <script type="text/javascript" src="/scripts/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxcore.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxchart.core.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxchart.rangeselector.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxdraw.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxdata.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxdatetimeinput.js"></script>
  <script type="text/javascript" src="/scripts/jqwidgets/jqxcalendar.js"></script>
  <script type="text/javascript" src="/scripts/charts.js"></script>
  <script type="text/ecmascript" src="/scripts/utils.js"></script>
  <script type="text/javascript">
    var name = "{{name}}";

    function buildURLForTimes(start, end) {
      $("#startAt").jqxDateTimeInput('setDate', start );
      $("#endAt").jqxDateTimeInput('setDate', end );
      url = encodeURI("/Analog/Data/" + name + "?start="
              + start.getUTCFullYear() + "-" + (start.getUTCMonth() + 1) + "-" + start.getUTCDate() + " " + start.getUTCHours() + ":" + start.getUTCMinutes()
              + "&end=" + end.getUTCFullYear() + "-" + (end.getUTCMonth() + 1) + "-" +  end.getUTCDate() + " " + end.getUTCHours() + ":" + end.getUTCMinutes());
      return url;
    }
    // Graph setup
    const settings = {{struct}}; //Struct is populated by the FireflyService application

    $(document).ready(function () {
      PopulateTitle();
      let Settings = {
        title: "Analog",
        description: "Analog Measurments.",
        enableAnimations: false,
        animationDuration: 1000,
        enableAxisTextAnimation: true,
        showLegend: true,
        padding: { left: 5, top: 5, right: 5, bottom: 5 },
        titlePadding: { left: 90, top: 0, right: 0, bottom: 10 },
        xAxis: {
          dataField: 'logged',
          type: 'date',
          showGridLines: false,
          textRotationAngle: 300,
          formatFunction: xAxisFormatFunction,
          minValue: start,
          maxValue: end,
          rangeSelector: {
            serieType: 'spline',
            padding: { /*left: 0, right: 0,*/ top: 20, bottom: 0 },
            backgroundColor: 'white',
            size: 110,
            gridLines: {visible: false},
            min: start,
            max: end,
            formatFunction: xAxisSelectorFormatFunction
          }
        },
        colorScheme: 'scheme01',
        seriesGroups: [{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[0].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[0].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[0].interval,
            },
            minValue: settings[0].min,
            maxValue: settings[0].max,
            description: settings[0].name,
          },
          series: [{
            dataField: 'a0',
            displayText: settings[0].name
          }]
        },{
            type: 'spline',
            valueAxis: {
              unitInterval: settings[1].interval / 2,
              gridLines: {
                visible: true,
                step: 1,
              },
              labels: {
                formatSettings: {
                  decimalPlaces: 1,
                },
                visible: true,
                step: 2, //settings[1].interval,
              },
              minValue: settings[1].min,
              maxValue: settings[1].max,
              description: settings[1].name,
            },
            series: [{
              dataField: 'a1',
              displayText: settings[1].name
            }]
          },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[2].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[2].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[2].interval,
            },
            minValue: settings[2].min,
            maxValue: settings[2].max,
            description: settings[2].name,
          },
          series: [{
            dataField: 'a2',
            displayText: settings[2].name
          }]
        },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[3].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[3].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[3].interval,
            },
            minValue: settings[3].min,
            maxValue: settings[3].max,
            description: settings[3].name,
          },
          series: [{
            dataField: 'a3',
            displayText: settings[3].name
          }]
        },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[4].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[4].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[4].interval,
            },
            minValue: settings[4].min,
            maxValue: settings[4].max,
            description: settings[4].name,
          },
          series: [{
            dataField: 'a4',
            displayText: settings[4].name
          }]
        },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[5].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[5].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[5].interval,
            },
            minValue: settings[5].min,
            maxValue: settings[5].max,
            description: settings[5].name,
          },
          series: [{
            dataField: 'a5',
            displayText: settings[5].name
          }]
        },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[6].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[6].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[6].interval,
            },
            minValue: settings[6].min,
            maxValue: settings[6].max,
            description: settings[6].name,
          },
          series: [{
            dataField: 'a6',
            displayText: settings[6].name
          }]
        },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[7].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[7].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[7].interval,
            },
            minValue: settings[7].min,
            maxValue: settings[7].max,
            description: settings[7].name,
          },
          series: [{
            dataField: 'a7',
            displayText: settings[7].name
          }]
        },{
          type: 'spline',
          valueAxis: {
            unitInterval: settings[7].interval / 2,
            gridLines: {
              visible: true,
              unitInterval: settings[7].interval / 2,
            },
            labels: {
              formatSettings: {
                decimalPlaces: 1,
              },
              visible: true,
              step: 2, //settings[7].interval,
            },
            minValue: 0,
            maxValue: 40,
            description: 'Temperature â„ƒ',
          },
          series: [{
            dataField: 'temperature',
            displayText: 'H2 Temperature'
          }]
        }]
      }
      setupChart(Settings);
      chart = $('#ChartContainer');
      if (settings[0].name === "Analog-0") {
        chart.jqxChart('hideSerie', 0, 0, NaN);
      }
      if (settings[1].name === "Analog-1") {
        chart.jqxChart('hideSerie', 1, 0, NaN);
      }
      if (settings[2].name === "Analog-2") {
        chart.jqxChart('hideSerie', 2, 0, NaN);
      }
      if (settings[3].name === "Analog-3") {
        chart.jqxChart('hideSerie', 3, 0, NaN);
      }
      if (settings[4].name === "Analog-4") {
        chart.jqxChart('hideSerie', 4, 0, NaN);
      }
      if (settings[5].name === "Analog-5") {
        chart.jqxChart('hideSerie', 5, 0, NaN);
      }
      if (settings[6].name === "Analog-6") {
        chart.jqxChart('hideSerie', 6, 0, NaN);
      }
      if (settings[7].name === "Analog-7") {
        chart.jqxChart('hideSerie', 7, 0, NaN);
      }
    });

  </script>
</head>
  <body style="background:white;" onload="PopulateTitle()">
    <header class="header">
      <h1>
        <span class="system" id="system">Loading...</span>
        <img id="logo" class="logo" src="/images/logo.png" alt="ElektrikGreen Logo"/>
      </h1>
    </header>
    <div id='ChartContainer' style="width:100%; height: 96%;" ></div>
    <div style="text-align:center; height: 4%;">
      <div style="float:left;">
        <label for="timeRange">Time Span</label>
        <select id="timeRange" onchange="getCurrent()">
          <option value=1>Focus on selection</option>
          <option value=2>Double selection</option>
          <option value=259200000>3 Days</option>
          <option value=172800000>2 Days</option>
          <option value=86400000>24 Hours</option>
          <option value=43200000>12 Hours</option>
          <option value=28800000 selected='selected'>8 Hours</option>
          <option value=14400000>4 Hours</option>
          <option value=7200000>2 Hours</option>
          <option value=3600000>1 Hour</option>
          <option value=1800000>30 Minutes</option>
          <option value=900000>15 Minutes</option>
          <option value=600000>10 Minutes</option>
          <option value=300000>5 Minutes</option>
          <option value=0>Custom</option>
        </select>
      </div>
      <div id="customDateTimes" style="float:left; padding-left: 10px;">
        <span style="float:left;font-size:larger;">Start At:&nbsp;</span>
        <div id="startAt"></div>
        <span style="float:left;font-size:larger;">&nbsp;End At:&nbsp;</span>
        <div id="endAt"></div>&nbsp;
        <button onClick="refresh(buildURLCustomTimes())" style="height:100%; width:100px;" >Update</button>
      </div>
      <div  style="float:left; padding-left: 10px;"><label for="autoRefresh"><input id="autoRefresh" type="checkbox" onclick="clickAutoRefresh(this)">Auto Refresh</label></div>
      <div id="waiting" style="float:left; visibility:visible; padding-left: 10px;"><span>Fetching Data please stand by...</span></div>
    </div>
  </body>
</html>
